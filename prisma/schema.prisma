generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  email     String     @unique
  auth0_id  String     @unique
  customers Customer[]

  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(3)

  @@map("users")
}

model Customer {
  id        String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  document  String            @unique
  birthdate DateTime
  email     String            @unique
  phone     String            @unique
  ownerId   String            @db.Uuid
  owner     User              @relation(fields: [ownerId], references: [id])
  addresses CustomerAddress[]

  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(3)

  @@map("customers")
}

model CustomerAddress {
  id           Int         @id @default(autoincrement())
  state        String
  city         String
  neighborhood String
  street       String
  house        String
  complement   String?
  address_type AddressType
  customerId   String      @db.Uuid
  customer     Customer    @relation(fields: [customerId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("customer_addresses")
}

enum AddressType {
  COMMERCIAL
  RESIDENTIAL
}
